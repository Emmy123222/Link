<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VUNO - Premium Video Calling</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary': {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            'background-dark': '#0f172a',
            'surface-dark': '#1e293b',
            'surface-light': '#f1f5f9',
          }
        }
      }
    }
  </script>
  
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .video-container {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .control-btn {
      transition: all 0.2s ease;
    }
    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .control-btn:active {
      transform: scale(0.95);
    }
    .participant-grid {
      display: grid;
      gap: 16px;
      padding: 16px;
      height: 100%;
      width: 100%;
    }
    .participant-tile {
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: relative;
      background: rgba(30, 41, 59, 0.5);
    }
    .participant-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    .floating-controls {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 50;
    }
    .participant-info {
      position: absolute;
      bottom: 12px;
      left: 12px;
      padding: 6px 12px;
      border-radius: 20px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .pip-video {
      transition: all 0.3s ease;
    }
    .pip-video:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    .call-status {
      position: fixed;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 40;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .video-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    }
    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      color: white;
      background: rgba(14, 165, 233, 0.2);
    }
    .grid-1 { grid-template-columns: 1fr; }
    .grid-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-3 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
    .grid-3 .participant-tile:last-child { grid-column: span 2; }
    .grid-4 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
    .grid-5 { 
      grid-template-columns: repeat(3, 1fr); 
      grid-template-rows: repeat(2, 1fr); 
    }
    .grid-5 .participant-tile:last-child { grid-column: span 2; }
    .grid-6 { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); }
    .grid-many {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      grid-auto-rows: minmax(200px, auto);
    }
    .active-speaker {
      border: 2px solid #0ea5e9;
      box-shadow: 0 0 20px rgba(14, 165, 233, 0.4);
    }
    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 12px 16px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 60;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    .notification.show {
      transform: translateX(0);
    }
  </style>
</head>
<body class="h-full bg-background-dark text-white overflow-hidden">
  <div class="flex flex-col h-full relative">
    <!-- Video Area -->
    <div id="my-video-container" class="video-container absolute inset-0 w-full h-full">
      <!-- Participant Grid -->
      <div id="participant-grid" class="participant-grid grid-1">
        <!-- Remote participants will be added here dynamically -->
        
        <!-- Local Video (PiP) - Initially shown as main when alone -->
        <div id="local-video-container" class="participant-tile h-full">
          <video id="my-video-preview" autoplay muted playsinline class="w-full h-full object-cover"></video>
          <div class="participant-info text-sm">
            <span>You</span>
            <i class="fas fa-volume-mute text-red-400 hidden" id="mic-muted-indicator"></i>
          </div>
        </div>
      </div>
      
      <!-- Call Status Bar -->
      <div class="call-status glass-effect px-4 py-2 rounded-full flex items-center space-x-2 fade-in">
        <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
        <span class="text-sm font-medium" id="call-status-text">Connecting...</span>
      </div>
    </div>
    
    <!-- Floating Controls -->
    <div class="floating-controls glass-effect px-6 py-3 rounded-2xl flex items-center space-x-4">
      <!-- Microphone Button -->
      <button id="mic-toggle" class="control-btn w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20">
        <i class="fas fa-microphone text-xl"></i>
      </button>
      
      <!-- Camera Button -->
      <button id="camera-toggle" class="control-btn w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20">
        <i class="fas fa-video text-xl"></i>
      </button>
      
      <!-- Screen Share Button -->
      <button id="screenshare-toggle" class="control-btn w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20">
        <i class="fas fa-desktop text-xl"></i>
      </button>
      
      <!-- Participants Button -->
      <button id="participants-toggle" class="control-btn w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20">
        <i class="fas fa-users text-xl"></i>
        <span id="participant-count" class="absolute -top-2 -right-2 bg-primary-600 text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
      </button>
      
      <!-- More Options -->
      <div class="relative">
        <button id="more-options" class="control-btn w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20">
          <i class="fas fa-ellipsis-h text-xl"></i>
        </button>
      </div>
      
      <!-- End Call Button -->
      <button id="end-call" class="control-btn w-14 h-14 rounded-full bg-red-600 flex items-center justify-center text-white hover:bg-red-700">
        <i class="fas fa-phone text-xl transform rotate-135"></i>
      </button>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
      <div class="flex items-center">
        <i class="fas fa-info-circle text-primary-400 mr-2"></i>
        <span id="notification-text"></span>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const myVideoPreview = document.getElementById('my-video-preview');
    const micToggle = document.getElementById('mic-toggle');
    const cameraToggle = document.getElementById('camera-toggle');
    const micMutedIndicator = document.getElementById('mic-muted-indicator');
    const callStatusText = document.getElementById('call-status-text');
    const participantGrid = document.getElementById('participant-grid');
    const localVideoContainer = document.getElementById('local-video-container');
    const participantCount = document.getElementById('participant-count');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    
    // State
    let isMicMuted = false;
    let isCameraOff = false;
    let localStream = null;
    let participants = [];
    let activeSpeakerId = null;
    
    // Start user media
    async function startMyVideo() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ 
          video: { width: 1280, height: 720 },
          audio: true 
        });
        
        myVideoPreview.srcObject = stream;
        window.localStream = stream;
        localStream = stream;
        
        // Update UI
        callStatusText.textContent = 'Connected';
        document.querySelector('.call-status .w-3').classList.remove('bg-red-500');
        document.querySelector('.call-status .w-3').classList.add('bg-green-500');
        
        // Add mock participants for demonstration
        setTimeout(() => {
          addMockParticipant('John Doe', 'JD', 'primary');
          setTimeout(() => {
            addMockParticipant('Emma Wilson', 'EW', 'green');
            setTimeout(() => {
              addMockParticipant('Alex Johnson', 'AJ', 'purple');
            }, 1500);
          }, 1500);
        }, 1500);
        
      } catch (err) {
        console.error("Error accessing camera/microphone:", err);
        callStatusText.textContent = 'Connection failed';
        showNotification('Could not access camera or microphone. Please check permissions.');
      }
    }
    
    // Show notification
    function showNotification(message, duration = 3000) {
      notificationText.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, duration);
    }
    
    // Update grid layout based on number of participants
    function updateGridLayout() {
      const totalParticipants = participants.length + 1; // +1 for local video
      
      // Remove all grid classes
      participantGrid.className = 'participant-grid gap-4 p-4 h-full w-full';
      
      // Add appropriate grid class
      if (totalParticipants === 1) {
        participantGrid.classList.add('grid-1');
      } else if (totalParticipants === 2) {
        participantGrid.classList.add('grid-2');
      } else if (totalParticipants === 3) {
        participantGrid.classList.add('grid-3');
      } else if (totalParticipants === 4) {
        participantGrid.classList.add('grid-4');
      } else if (totalParticipants === 5) {
        participantGrid.classList.add('grid-5');
      } else if (totalParticipants === 6) {
        participantGrid.classList.add('grid-6');
      } else {
        participantGrid.classList.add('grid-many');
      }
      
      // Update participant count badge
      participantCount.textContent = participants.length;
      if (participants.length > 0) {
        participantCount.classList.remove('hidden');
      } else {
        participantCount.classList.add('hidden');
      }
    }
    
    // Add a mock participant for demonstration
    function addMockParticipant(name, initials, color) {
      const id = `participant-${Date.now()}`;
      const participant = {
        id,
        name,
        initials,
        color,
        audioActive: true,
        videoActive: true
      };
      
      participants.push(participant);
      
      const participantTile = document.createElement('div');
      participantTile.id = id;
      participantTile.className = 'participant-tile fade-in';
      
      participantTile.innerHTML = `
        <div class="video-placeholder">
          <div class="avatar bg-${color}-500/20">
            ${initials}
          </div>
        </div>
        <div class="participant-info">
          <span>${name}</span>
          <i class="fas fa-microphone ${participant.audioActive ? 'text-green-400' : 'text-red-400'}"></i>
          ${!participant.videoActive ? '<i class="fas fa-video-slash text-red-400"></i>' : ''}
        </div>
      `;
      
      // Add to grid
      participantGrid.appendChild(participantTile);
      
      // Update grid layout
      updateGridLayout();
      
      // Randomly toggle audio/video for demonstration
      setInterval(() => {
        if (Math.random() > 0.7) {
          toggleParticipantAudio(participant);
        }
      }, 5000);
      
      // Randomly make this participant the active speaker
      setInterval(() => {
        if (Math.random() > 0.8) {
          setActiveSpeaker(id);
        }
      }, 3000);
      
      showNotification(`${name} joined the call`);
    }
    
    // Toggle participant audio for demo
    function toggleParticipantAudio(participant) {
      participant.audioActive = !participant.audioActive;
      const micIcon = document.querySelector(`#${participant.id} .fa-microphone`);
      if (micIcon) {
        micIcon.classList.toggle('text-green-400');
        micIcon.classList.toggle('text-red-400');
      }
    }
    
    // Set active speaker
    function setActiveSpeaker(id) {
      // Remove active class from all participants
      participants.forEach(p => {
        const element = document.getElementById(p.id);
        if (element) {
          element.classList.remove('active-speaker');
        }
      });
      
      // Add active class to current speaker
      if (id !== 'local') {
        const element = document.getElementById(id);
        if (element) {
          element.classList.add('active-speaker');
          activeSpeakerId = id;
          
          // Move active speaker to the beginning of the grid
          participantGrid.prepend(element);
        }
      }
    }
    
    // Toggle microphone
    micToggle.addEventListener('click', () => {
      isMicMuted = !isMicMuted;
      
      if (localStream) {
        localStream.getAudioTracks().forEach(track => {
          track.enabled = !isMicMuted;
        });
      }
      
      // Update UI
      if (isMicMuted) {
        micToggle.innerHTML = '<i class="fas fa-microphone-slash text-xl"></i>';
        micMutedIndicator.classList.remove('hidden');
        showNotification('Microphone muted');
      } else {
        micToggle.innerHTML = '<i class="fas fa-microphone text-xl"></i>';
        micMutedIndicator.classList.add('hidden');
        showNotification('Microphone on');
      }
    });
    
    // Toggle camera
    cameraToggle.addEventListener('click', () => {
      isCameraOff = !isCameraOff;
      
      if (localStream) {
        localStream.getVideoTracks().forEach(track => {
          track.enabled = !isCameraOff;
        });
      }
      
      // Update UI
      if (isCameraOff) {
        cameraToggle.innerHTML = '<i class="fas fa-video-slash text-xl"></i>';
        myVideoPreview.classList.add('hidden');
        document.querySelector('#local-video-container .video-placeholder')?.classList.remove('hidden');
        showNotification('Camera turned off');
      } else {
        cameraToggle.innerHTML = '<i class="fas fa-video text-xl"></i>';
        myVideoPreview.classList.remove('hidden');
        document.querySelector('#local-video-container .video-placeholder')?.classList.add('hidden');
        showNotification('Camera turned on');
      }
    });
    
    // End call button
    document.getElementById('end-call').addEventListener('click', () => {
      // Simple confirmation
      if (confirm('End the call?')) {
        // Here you would typically close the peer connections
        if (localStream) {
          localStream.getTracks().forEach(track => track.stop());
        }
        window.close(); // In a real app, you would navigate away
      }
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Add video placeholder for local video
      const placeholder = document.createElement('div');
      placeholder.className = 'video-placeholder hidden';
      placeholder.innerHTML = '<div class="avatar bg-primary-500/20">You</div>';
      localVideoContainer.prepend(placeholder);
      
      startMyVideo();
    });
  </script>
</body>
</html>