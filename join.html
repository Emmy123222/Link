<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VUNO - Join Meeting</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <!-- Tailwind Custom Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        screens: {
          sm: '640px',
          md: '768px',
          lg: '1024px',
          xl: '1280px',
          '2xl': '1536px',
        },
        extend: {
          fontFamily: {
            sans: ['"Inter Variable"', 'Inter', 'system-ui', 'sans-serif'],
            display: ['"Geist Variable"', '"Geist"', 'Inter', 'system-ui', 'sans-serif'],
            mono: ['"Geist Mono Variable"', '"Geist Mono"', 'monospace'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            background: {
              light: '#ffffff',
              dark: '#0a0a0a',
            },
            surface: {
              light: '#f8fafc',
              dark: '#1a1a1a',
            },
            text: {
              primary: {
                light: '#18181b',
                dark: '#fafafa',
              },
              secondary: {
                light: '#52525b',
                dark: '#a1a1aa',
              }
            },
            border: {
              light: '#e4e4e7',
              dark: '#3f3f46',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out forwards',
            'slide-in': 'slideIn 0.3s ease-out forwards',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(-20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
          }
        }
      }
    };
  </script>

  <!-- Custom Styles -->
  <style>
    @import url('https://cdn.jsdelivr.net/npm/@fontsource-variable/inter@5.0.3/index.min.css');
    @import url('https://cdn.jsdelivr.net/npm/@fontsource-variable/geist-sans@1.1.1/index.min.css');
    @import url('https://cdn.jsdelivr.net/npm/@fontsource-variable/geist-mono@1.1.1/index.min.css');

    body {
      @apply font-sans text-text-primary-light bg-background-light dark:text-text-primary-dark dark:bg-background-dark;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    .active-scale {
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }
    .active-scale:active {
      transform: scale(0.97);
    }

    .transition-smooth {
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .border-light {
      @apply border border-border-light dark:border-border-dark;
    }

    .join-btn:disabled {
      @apply bg-primary-300 dark:bg-primary-800 cursor-not-allowed;
    }

    .join-btn:not(:disabled):hover {
      @apply bg-primary-700 dark:bg-primary-500 shadow-lg;
    }

    .input-glow:focus {
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
    }

    .badass-input {
      background-clip: padding-box;
      transition: all 0.2s ease;
      letter-spacing: 0.5px;
    }

    .badass-input:focus {
      border-color: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.3);
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md mx-auto">
  <!-- Top Header Row -->
<div class="fixed top-0 left-0 right-0 bg-surface-light dark:bg-surface-dark z-50 shadow-sm py-4 px-6 flex items-center justify-between border-b border-border-light dark:border-border-dark">
  <!-- Back Arrow -->
  <a href="index.html" class="flex-shrink-0 text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 transition-colors">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
    </svg>
  </a>
  
  <!-- Title -->
  <h1 class="text-xl md:text-2xl font-bold text-center font-display flex-grow px-4">
    Join a Meeting
  </h1>
  
  <!-- Join Button -->
  <button id="joinBtn" disabled class="join-btn flex-shrink-0 px-4 py-1.5 md:px-5 md:py-2 bg-primary-600 dark:bg-primary-600 text-white font-medium rounded-full shadow-md transition-all duration-300 transform hover:scale-105 active:scale-95 disabled:opacity-70 text-sm md:text-base">
    Join
  </button>
</div>
    
 <!-- Input Section -->
<div class="space-y-4 mt-100 px-4">  <!-- Added mt-20 for header space and px-4 for side padding -->
  <p class="text-text-secondary-light dark:text-text-secondary-dark text-center text-sm md:text-base">
    Enter the code provided by the meeting organizer
  </p>
  
  <div class="relative">
    <input 
      id="meetingIdInput"
      type="text" 
      class="badass-input w-full px-6 py-4 text-base md:text-lg bg-surface-light dark:bg-surface-dark rounded-xl border-light focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
      placeholder="Meeting ID"
      autocomplete="off"
      autocapitalize="off"
      spellcheck="false"
    >
    <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-text-secondary-light dark:text-text-secondary-dark" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
      </svg>
    </div>
  </div>
</div>

<script>
  const joinBtn = document.getElementById('joinBtn');
  const meetingIdInput = document.getElementById('meetingIdInput');

  // Enable/disable button
  meetingIdInput.addEventListener('input', (e) => {
    joinBtn.disabled = e.target.value.trim().length === 0;
  });

  joinBtn.addEventListener('click', async () => {
    let meetingId = meetingIdInput.value.trim();
    if (!meetingId) return;

    // ✅ Handle full link or raw UUID
    try {
      if (meetingId.startsWith("http")) {
        const url = new URL(meetingId);
        meetingId = url.searchParams.get("meeting");
        if (!meetingId) throw new Error("Invalid meeting link");
      }
    } catch (err) {
      alert("❌ Invalid meeting link or ID");
      return;
    }

    const token = localStorage.getItem("authToken");
    if (!token) {
      alert("⚠️ You must log in first.");
      window.location.href = "signin.html";
      return;
    }

    try {
      const res = await fetch(`https://vuno-1.onrender.com/call/meetings/${meetingId}/join/`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json"
        }
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.detail || "Failed to join meeting");
      }

      const data = await res.json();
      console.log("✅ Joined meeting:", data);

      // Redirect after successful join
      window.location.href = `contact.html?meeting=${meetingId}`;
    } catch (error) {
      console.error("❌ Error:", error);
      alert("❌ Could not join meeting. " + error.message);
    }
  });
</script>


</body>
</html>